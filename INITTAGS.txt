#
# History
#   2013nov25, DSNR, created
#   2013dec10, DSNR, updated for PPXF implementation; removed stellar
#                    z and sigma optimization tags, since PPXF does
#                    this
#   2013dec19, DSNR, changed MASKWIDTHS and PEAKINIT to hashes for
#                    consistency with other tags that initialize
#                    things according to which emission lines they
#                    apply to
#   2014jan17, DSNR, added TWEAKCNTFIT
#   2014jan29, DSNR, added DATEXT, VAREXT, DQEXT
#   2014feb17, DSNR, added PPXF_MAXDEG_ADDPOLY, removed ADDPOLY2TEMP
#   2014feb27, DSNR, added ZSYS_GAS, PLATESCALE, SPECRES
#   2014apr17, DSNR, added ARGSMAKEMAP
#   2014mayXY, DSNR, added FCNCHECKCOMP
#   2014may08, DSNR, added ARGSNORMNAD, ARGSPLTNORMNAD
#   2014may09, DSNR, added a bunch of NaD-related tags
#   2014may15, DSNR, added ARGSNADWEQ
#   2014may23, DSNR, moved ARGSMAKEMAP structure and NaD parameters 
#                    to their own variables

This file describes the parameters that are contained in the INITDAT
and INITMAP structures. These structures are created in the
initialization procedure and passed to IFSF, IFSFA, and other
routines, and contain parameters that apply to the dataset as a whole
(e.g., the lines to be fit or an array containing the initial redshift
guesses for all spaxels). IFSF passes INITDAT to IFSF_FITSPEC without
changing it.

=======
INITDAT
=======

Tags are in alphabetical order.

Required structure tags from initialization procedure:

  fcninitpar: in, required, type=string
    Name of function for initializing emission lines.
  infile: in, required, type=string
    Filename (possibly including path) of input data cube.
  label: in, required, type=string
    Common label for output files.
  lines: in, required, type=strarr(nlines)
    Names of emission lines to fit.
  linetie: in, required, type=hash(lines)
    Name of emission line to which each emission line is tied
    (in redshift and linewidth).
  mapdir: in, required, type=string
    Directory for output maps.
  maxncomp: in, required, type=double
    Maximum number of components to fit.
  ncomp: in, required, type=hash(lines,ncols,nrows)
    For each spaxel and emission line, # of components to fit.
  outdir: in, required, type=string
    Directory for output .xdr file and analysis files (plots, lists).
  platescale: in, required, type=double
    Size of pixel in arcseconds.
  positionangle: in, required, type=double
    Position angle of IFS FOV, in degrees E of N.
  specres: in, required, type=double
    Spectral resolution of spectrograph in Angstroms, used for
    correcting linewidths for the instrumental profile. Code does not
    yet properly handle instruments with constant resolution in km/s,
    at least in this respect.
  zinit_stars: in, required, type=dblarr(ncols,nrows)
    Redshift used to shift any stellar templates to observed
    frame.
  zinit_gas: in, required, type=hash(lines,ncols,nrows,maxncomp)
    Initial redshift guesses for each spaxel, emission line, and
    component.
  zsys_gas: in, required, type=double
    Systemic redshift for gas, used for calculating velocities
    w.r.t. systemic.

Optional structure tags from initialization procedure:

  argscontfit: in, optional, type=structure
    Arguments for continuum fit routine.
  argsinitpar: in, optional, type=structure
    Arguments for parameter initialization routine.
  argslinefit: in, optional, type=structure
    Arguments for line fitting routine
  argslinelist: in, optional, type=structure
    Arguments for line selection routine
  argspltlin1: in, optional, type=structure
    Arguments for first line plot
  argspltlin2: in, optional, type=structure
    Arguments for first line plot
  datext: in, optional, type=integer, default=1
    Extension # for data plane in data cube.
  dividecont: in, optional, type=byte
    Set this param to divide the data by the continuum
    fit. Default is to subtract.
  dqext: in, optional, type=integer, default=3
    Extension # for dq plane in data cube.
  donad: in, optional, type=byte
    Run NaD analysis (normalization and finding weq) in IFSFA.
  fcncheckcomp: in, optional, type=string
    Name of function for automatically testing significance of
    components.
  fcncontfit: in, optional, type=string
    Name of continuum fitting function. If not specified, no continuum
    is fit. If this equals 'ppxf,' then PPXF is used to fit the
    stellar velocity, velocity dispersion, and template weights. PPXF
    requires a template to be chosen and an initial guess for sigma
    (siginit_stars) to be specified.
  fcnlinefit: in, optional, type=string
    Name of line fitting function. Default: IFSF_MANYGAUSS
  fcnpltcont: in, optional, type=string
    Name of continuum plotting function. Default: IFSF_PLTCONT
  fcnpltlin: in, optional, type=string
    Name of line plotting function. Default: IFSF_PLTLIN
  fitran: in, optional, type=dblarr(2)
    Range of fitting, in observed frame. If not set, default is
    entire range of data / template intersection.
  keepnad: in, optional, type=string
    Set to not remove NaD region from fit.
  loglam: in, optional, type=byte
    Set if data has constant log(lambda) dispersion.
  maskwidths: in, optional, type=hash(lines,maxncomp)
    Widths, in km/s, of regions to mask from continuum fit. If not
    set, routine defaults to a value specified in IFSF_FITSPEC
    for all lines and components.
  masksig_secondfit: in, optional, type=double
    During second call to IFSF_FITSPEC, best-fit emission line sigmas
    are multiplied by this value and set to 'maskwidths' parameter. If
    not set, routine defaults to a value specified in IFSF for all
    lines and components.
  nomaskran: in, optional, type=dblarr(2)
    Wavelength region *not* to mask.
  outlines: in, optional, type=strarr
    Labels of emission lines for which to print line fluxes to output.
  peakinit: in, optional, type=hash(lines,maxncomp)
    Initial peak flux guesses.
  peakinit: in, optional, type=hash(lines,maxncomp)
    Initial peak flux guesses.
  ppxf_maxdeg_addpoly: in, optional, type=integer, default=4
    Highest degree of additive Legendre polynomial terms added to the
    stellar templates in PPXF. This is also the number of terms added,
    one per degree up to the maximum. Set to -1 to not include any
    additive polynomials.
  siginit_gas: in, optional, type=hash(lines,maxncomp)
    Initial line width guesses, in sigma and km/s.  If not
    set, routine defaults to a value specified in IFSF_FITSPEC
    for all lines and components.
  siginit_stars: in, optional, type=double
    Initial sigma value, in km/s, for a Gaussian kernel for
    convolving with stellar template. Convolution only performed
    if this param is set.
  startempfile: in, optional, type=structure
    File containing IDL save file (usually ending in .xdr) of
    stellar templates. Tags:
      lambda: in, required, type=dblarr(nwave)
      flux: in, required, type=dblarr(nwave,ntemplates)
  tweakcntfit: in, optional, type=dblarr(ncols,nrows,3,maxregions)
    Parameters for tweaking continuum fit with localized
    polynomials. For each of nregions regions, array contains lower
    limit, upper limit, and polynomial degree.
  vacuum: in, optional, type=byte
    Set this param to shift stellar templates from air to
    vacuum wavelengths.
  varext: in, optional, type=integer, default=2
    Extension # for variance plane in data cube.

========
INITMAPS
========

  center_axes: in, optional, type=dblarr(2)
    [centcol,centrow]
  center_nuclei: in, optional, type=dblarr(2)
    [centcol,centrow]
  noemlinfit: in, optional, type=byte
    Set this switch if the spectrum was not first processed with
    IFSF.
  rangefile:  in, optional, type=string
     Full path and file name for file to manually set color scale
     ranges for plots.
  argslinratmaps: in, optional, type=structure
     If set, line ratios are plotted. The following tags govern the
     image:

  col: in, optional, type=structure
     If set, IFS continuum color image is created. The following
     tags govern the image.
     sumrange: in, required, type=dblarr(4)
       Lower and upper wavelength limits for summing together the blue
       and red continuum regions.
     scllim: in, required, type=dblarr(2)
       Lower and upper flux limits for byte scaling.
     stretch: in, required, type=long
       Function for byte scaling data. See CGIMGSCL for a list of
       possible values.
  ct: in, optional, type=structure
     If set, IFS continuum image is created. The following
     tags govern the image.
     sumrange: in, required, type=dblarr(2)
       Lower and upper wavelength limits for summing the continuum.
     scllim: in, required, type=dblarr(2)
       Lower and upper flux limits for byte scaling.
     stretch: in, required, type=long
       Function for byte scaling data. See CGIMGSCL for a list of
       possible values.
  hst: in, optional, type=structure
     If set (along with hstbl and/or hstrd), HST continuum image is
     loaded and plotted. The following tags govern the image.
     refcoords: in, required, type=longarr(2)
       Coordinates of reference point for aligning HST and IFS images.
     subim_sm: in, required, type=double
       Size of one side of (square) small subimage in arcseconds.
     subim_big: in, required, type=double
       Size of one side of (square) big subimage in arcseconds.
     smoothfwhm: in, required, type=double
       FWHM of Gaussian smoothing kernel, in pixels.
  hstbl: in, optional, type=structure
     If set (along with hst), blue HST continuum image is loaded and
     plotted. The following tags govern the image.
     file: in, required, type=string
     scllim: in, required, type=dblarr(2)
       Lower and upper flux limits for byte scaling.
     sclargs: in, required, type=structure
       Optional arguments for byte scaling routine (CGIMGSCL). If no
       arguments, then input a dummy tag.
  hstblsm: in, optional, type=structure
     If set (along with hstbl and hst), smoothed blue HST continuum
     image is created and plotted. The following tags govern the
     image.
     scllim: in, required, type=dblarr(2)
       Lower and upper flux limits for byte scaling.
     sclargs: in, required, type=structure
       Optional arguments for byte scaling routine (CGIMGSCL). If no
       arguments, then input a dummy tag.
     stretch: in, required, type=long
       Function for byte scaling data. See CGIMGSCL for a list of
       possible values.
  hstrd: in, optional, type=structure
     If set (along with hst), red HST continuum image is loaded and
     plotted. The following tags govern the image.
     file: in, required, type=string
     scllim: in, required, type=dblarr(2)
       Lower and upper flux limits for byte scaling.
     sclargs: in, required, type=structure
       Optional arguments for byte scaling routine (CGIMGSCL). If no
       arguments, then input a dummy tag.
  hstrdsm: in, optional, type=structure
     If set (along with hstrd and hst), smoothed red HST continuum
     image is created and plotted. The following tags govern the
     image.
     scllim: in, required, type=dblarr(2)
       Lower and upper flux limits for byte scaling.
     sclargs: in, required, type=structure
       Optional arguments for byte scaling routine (CGIMGSCL). If no
       arguments, then input a dummy tag.
     stretch: in, required, type=long
       Function for byte scaling data. See CGIMGSCL for a list of
       possible values.
  hstcol: in, optional, type=structure
     If set (along with hstrd and hstbl), HST continuum color
     image is created and plotted. The following tags govern the
     image.
     scllim: in, required, type=dblarr(2)
       Lower and upper flux limits for byte scaling.
     sclargs: in, required, type=structure
       Optional arguments for byte scaling routine (CGIMGSCL). If no
       arguments, then input a dummy tag.
     stretch: in, required, type=long
       Function for byte scaling data. See CGIMGSCL for a list of
       possible values.
  hstcol: in, optional, type=structure
     If set (along with hstrd, hstbl, hstrdsm, and hstblsm), smoothed
     HST continuum color image is created and plotted. The following
     tags govern the image.
     scllim: in, required, type=dblarr(2)
       Lower and upper flux limits for byte scaling.
     sclargs: in, required, type=structure
       Optional arguments for byte scaling routine (CGIMGSCL). If no
       arguments, then input a dummy tag.
     stretch: in, required, type=long
       Function for byte scaling data. See CGIMGSCL for a list of
       possible values.


=======
INITNAD
=======

  argsinitpar: in, optional, type=structure
    Arguments for initializing NaD + HeI fit.
  argsnadweq: in, optional, type=structure
    Arguments for computing NaD equivalent width
  argsnormnad: in, optional, type=structure
    Arguments for normalization of NaD continuum.
  argspltfitnad: in, optional, type=structure
    Arguments for plotting NaD fit.
  argspltnormnad: in, optional, type=structure
    Arguments for plotting normalization of NaD continuum.
  fcninitpar: in, required, type=string
    Name of function for initializing NaD + HeI fit.
  maxncomp: in, required, type=double
    Maximum number of HeI, NaD absorption, or NaD emission components.
  nnadabs: in, required, type=dblarr(ncols,nrows)
    Number of NaD absorption components to fit.
  nnadem: in, required, type=dblarr(ncols,nrows)
    Number of NaD emission components to fit.
  noemlinfit: in, optional, type=byte
    Set this switch if the spectrum was not first processed with
    IFSF.
  heitie: in, required, type=dblarr(ncols,nrows)
    Emission line to use for initializing fit of HeI 5876.
  nadabs_zinit: in, required, type=dblarr(ncols,nrows,nad_maxncomp)
    Initial redshift guesses for NaD absorption line fits.
  nadem_zinit: in, required, type=dblarr(ncols,nrows,nad_maxncomp)
    Initial redshift guesses for NaD emission line fits.
  nadabs_siginit: in, required, type=dblarr(ncols,nrows,nad_maxncomp)
    Initial sigma guesses for NaD absorption line fits.
  nadem_siginit: in, required, type=dblarr(ncols,nrows,nad_maxncomp)
    Initial sigma guesses for NaD emission line fits.
  nadabs_siglim: in, required, type=dblarr(2)
    Limits to sigma for NaD absorption.
  nadem_siglim: in, required, type=dblarr(2)
    Limits to sigma for NaD emission.
  taumax: in, optional, type=double, default=5
    Optical depth upper limit for NaD fitting.
